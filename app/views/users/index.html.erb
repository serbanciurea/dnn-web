<div class="admin-buttons">
  <% if !current_user.nil? && current_user.admin? %>
    <section class="usual-admin-actions">
      <h3>ADMIN ACTIONS</h3>

      <div class="admin-actions-buttons-row">
        <%= link_to "Add a project", new_project_port_path, class: 'gradient-button' %>
        <%= link_to "Add a job", new_job_path, class: 'gradient-button' %>
        <%= link_to "All jobs", jobs_path, class: 'gradient-button' %>
      </div>

    </section>
  <% end %>
</div>



<h2 class="title-index">New users - Verify and approve!</h2>
<div class="verify-and-approve">

  <table>
    <thead>
      <tr>
        <th>Users</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
  <% @unapproved_users.each do |user| %>
    <tr>
      <td><%= user.first_name %> <%= user.last_name %></td>
      <td>
        <%= link_to user_path(user) do %>
          <button class="gradient-button">PROFILE</button>
        <% end %>
        <%= button_tag 'Approve', id: "approve-button-#{user.id}", data: { user_id: user.id }, class: 'gradient-button' %>
        <%= button_tag 'Reject', id: "reject-button-#{user.id}", data: { user_id: user.id }, class: 'gradient-button' %>

        <script>
          document.addEventListener('DOMContentLoaded', () => {
            const approveButton<%= user.id %> = document.getElementById('approve-button-<%= user.id %>');
            console.log(approveButton<%= user.id %>);
            if (approveButton<%= user.id %>) {
              approveButton<%= user.id %>.addEventListener('click', () => {
                const userId = approveButton<%= user.id %>.dataset.userId;

                fetch(`/users/${userId}/approve`, {
                  method: 'PATCH',
                  headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
                  },
                  body: JSON.stringify({ /* Optional: Any additional data you want to send */ })
                })
                .then(response => {
                  if (!response.ok) {
                    throw new Error('Network response was not ok');
                  }
                  return response.json();
                })
                .then(data => {
                  // Handle success response
                  console.log('User approval successful:', data);
                  // Optionally update UI or show a success message
                  approveButton<%= user.id %>.remove();
                })
                .catch(error => {
                  // Handle error
                  console.error('Error approving user:', error);
                  // Optionally show an error message to the user
                });
              });
            }

            const rejectButton<%= user.id %> = document.getElementById('reject-button-<%= user.id %>');
            console.log(rejectButton<%= user.id %>);
            if (rejectButton<%= user.id %>) {
              rejectButton<%= user.id %>.addEventListener('click', () => {
                const userId = rejectButton<%= user.id %>.dataset.userId;

                fetch(`/users/${userId}/reject`, {
                  method: 'PATCH',
                  headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
                  },
                  body: JSON.stringify({ /* Optional: Any additional data you want to send */ })
                })
                .then(response => {
                  if (!response.ok) {
                    throw new Error('Network response was not ok');
                  }
                  return response.json();
                })
                .then(data => {
                  // Handle success response
                  console.log('User approval successful:', data);
                  // Optionally update UI or show a success message
                  rejectButton<%= user.id %>.remove();
                })
                .catch(error => {
                  // Handle error
                  console.error('Error approving user:', error);
                  // Optionally show an error message to the user
                });
              });
            }

          });
        </script>
      </td>
    </tr>
  <% end %>

    </tbody>
  </table>
</div>

<%#= render 'search_form' %>
