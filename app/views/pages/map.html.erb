<div id='map' style='width: 100%; height: 500px;'></div>

<script>
  mapboxgl.accessToken = '<%= Rails.application.credentials.dig(:mapbox, :api_key) %>';
  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [-0.1276, 51.5074], // Initial center set to London
    zoom: 5
  });

  var user = <%= @user.to_json(only: [:latitude, :longitude, :name, :address]) %>;

  user.forEach(function(user) {
    new mapboxgl.Marker()
      .setLngLat([user.longitude, user.latitude])
      .setPopup(new mapboxgl.Popup().setHTML(`<h3>${user.name}</h3><p>${user.address}</p>`))
      .addTo(map);
  });
</script>
