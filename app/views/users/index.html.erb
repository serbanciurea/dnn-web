<h3>People that need to be verified and approved:</h3>

<table>
  <thead>
    <tr>
      <th>Users</th>
      <th>Approved</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
<% @unapproved_users.each do |user| %>
  <tr>
    <td><%= user.first_name %> <%= user.last_name %></td>
    <td><%= user.approved? ? 'Yes' : 'No' %></td>
    <td>
      <%= link_to user_path(user) do %>
        <button class="gradient-button">PROFILE</button>
      <% end %>
      <%= button_tag 'Approve', id: "approve-button-#{user.id}", data: { user_id: user.id }, class: 'gradient-button' %>

      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const approveButton<%= user.id %> = document.getElementById('approve-button-<%= user.id %>');
          console.log(approveButton<%= user.id %>);
          if (approveButton<%= user.id %>) {
            approveButton<%= user.id %>.addEventListener('click', () => {
              const userId = approveButton<%= user.id %>.dataset.userId;

              fetch(`/users/${userId}/approve`, {
                method: 'PATCH',
                headers: {
                  'Content-Type': 'application/json',
                  'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
                },
                body: JSON.stringify({ /* Optional: Any additional data you want to send */ })
              })
              .then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              })
              .then(data => {
                // Handle success response
                console.log('User approval successful:', data);
                // Optionally update UI or show a success message
                approveButton<%= user.id %>.remove();
              })
              .catch(error => {
                // Handle error
                console.error('Error approving user:', error);
                // Optionally show an error message to the user
              });
            });
          }
        });
      </script>
    </td>
  </tr>
<% end %>

  </tbody>
</table>
