
<div class="course-grid">
  <% @courses.each do |course| %>
    <div class="course-card">
      <h3 class="course-title"><%= course.name %></h3>
      <p class="date-range">
        <% if course.start_date && course.end_date %>
          <%= course.start_date.strftime("%B %d, %Y") %> - <%= course.end_date.strftime("%B %d, %Y") %>
        <% else %>
          Press read more to see available dates.
        <% end %>
      </p>
      <div class="course-details">
        <p class="location-and-members">
          <span class="location"><i class="fas fa-map-location-dot"></i> <%= course.location || 'Suite 605, WD6 2BW'%></span>
          <span class="members"><i class="fa-solid fa-user-group" style="color: #EA5D30;"></i> <%= course.member_number || '12' %></span>
        </p>
        <p class="price"><%= number_to_currency(course.price, unit: 'Â£') %></p>
      </div>
      <p class="course-description">
          <%#= truncate(format_description(course.description), length: 100, omission: '...') %>
    <% if course.description %>
      <% formatted_description = format_description(course.description) %>
      <% truncated_description = truncate_html(formatted_description, length: 0, omission: '...') %>
      <%= truncated_description %>
    <% end %>

        <%#= format_description(@course.description) %>
      </p>
      <div class="course-actions">
        <%= link_to 'MORE', show_by_name_courses_path(course.name), class: 'gradient-button' %>
        <% value = Course.where(name: course.name).length > 1 %>
        <button class="gradient-button book-now-button" data-course="<%= course.name %>" data-modal-id="<%= course.id %>"><%= value === true ? 'BOOK' : 'ENQUIRE' %></button>
      </div>
    </div>

    <div id="bookingModal<%= course.id %>" class="modal" style="display: none;">
      <div class="modal-content">
        <h3><%= value === true ? 'Book Your Spot' : 'Enquire This Course' %></h3>
        <p><%= value === true ? 'You are booking the course' : 'You are enquiring the course' %> "<span class="modal-course-name" id="modal-course-name"><%= course.name %></span>". Choose an option:</p>
        <div class="modal-actions">
          <a href="tel:+0771520381" class="gradient-button">Call Us</a>
          <a href="mailto:info@dnnovation.com?subject=Booking Inquiry for <%= course.name %>" class="gradient-button">Send an Email</a>
        </div>
        <button class="gradient-button close-modal" data-modal-id="<%= course.id %>">Cancel</button>
      </div>
    </div>
  <% end %>
</div>

<!-- Full-Screen Modal -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Open modal when "Book Now" button is clicked
    document.querySelectorAll('.book-now-button').forEach(button => {
      button.addEventListener('click', function() {
        const modalId = this.dataset.modalId;
        const modal = document.getElementById(`bookingModal${modalId}`);
        const modalCourseName = modal.querySelector(".modal-course-name");

        if (modal) {
          modalCourseName.textContent = this.dataset.course;
          modal.style.display = "block";
        }
      });
    });

    // Close modal when "x" is clicked
 document.querySelectorAll('.close-modal').forEach(button => {
    button.addEventListener('click', function() {
      const modalId = this.dataset.modalId;
      const modal = document.getElementById(`bookingModal${modalId}`);
      modal.style.display = 'none';
    });
  });

    // Close modal when clicking outside of it
    window.addEventListener('click', function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = "none";
      }
    });
  });
</script>
